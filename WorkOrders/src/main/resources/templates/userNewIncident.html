<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Incident Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<style>
    button {border-radius: 12px;}
</style>
<body>
    <div style="text-align:right">
        <div style="text-align:center" sec:authorize="hasRole('ROLE_USER')">You're signed in! <strong>[[${username}]]</strong>
            <div th:action="@{/}" method="post">
                <button type="button" onclick="location.href='/group/profile'" id="userProfile" style="font-family: Arial, Helvetica, sans-serif;">Profile</button>
                <button type="button" value="Logout" onclick="location.href='/'" style="font-family: Arial, Helvetica, sans-serif;"> Logout </button>
                <button type="button" value="Back" style="font-family: Arial, Helvetica, sans-serif;" onclick="history.back()"> Back </button>
            </div>
        </div>
    </div>
<body>
<script th:inline="javascript">
/*<![CDATA[*/
	var buildings = /*[[${buildings}]]*/

window.onload = function(){
	var buildingSel = document.getElementById("building")
	for(x in buildings)
		{
		buildingSel.options[buildingSel.options.length] = new Option(buildings[x].building, buildings[x].id)
		}
}

/*While called changeRooms a better name would be populateDropDowns as it fills the rooms and departments dropdowns
 * with the proper information from the buildings.
 */
function changeRoom(chosen)
{
	var rooms = document.getElementById("room") 
	var departments = document.getElementById("department")
	
	var currentRooms = buildings[chosen-1].rooms;
	var currentDepts = buildings[chosen-1].department;
	
	rooms.length=1;
	departments.length=1;
	for(var x in currentRooms)
		{
		rooms.options[rooms.options.length] = new Option(currentRooms[x].roomNumbers,currentRooms[x].roomNumbers);
		}
	for(var y in currentDepts)
		{
		departments.options[departments.options.length] = new Option(currentDepts[y].department, currentDepts[y].department);
		}
}
/*]]>*/
</script>
<style>
div h1 {
	border-bottom: 4px Solid black;
}

td, table {
	padding: 10px;
}
</style>
	<div class="container">
		<div id="title">
			<h1 style="color: darkgreen; text-align: left">New Incident
				Report</h1>
		</div>
		<div style="text-align:left">
    <input type="button" value="Back" onclick="history.back()">
    </div>
		<form action="#" th:action="@{/group/userIncidentSave}"
			th:object="${incidents}" method="post"
			style="max-width: 600px; margin: 0 auto;">
			<div id="table" class="m-3">
				<table style="margin-right: auto; padding-left: 15px;">
					<thead>
					</thead>
					<tbody>
					
						<tr>
							<td>
								<div class="form-group row">
									<label class="col-4 col-form-label">Date: </label>
									<div class="col-8">
										<input type="date" id="datefield" name="date"
											class="form-control" th:min="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" th:max="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
											required th:field="*{date}" title="Select the date of the incident's occurance">
									</div>
								</div>
							</td>
						</tr>
						<tr>
							<td>
								<div class="form-group row">
									<label for="Severity">Issue Severity: </label> <select
										name="severity" id="severity" class="form-control" required
										th:field="*{severity}" title="Issue Severity is on a scale of low, medium, to high being the least severe and 5 the most.">
										<option th:value="low">low</option>
										<option th:value="medium">medium</option>
										<option th:value="high">high</option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<td>
								<div class="form-group row">
									<label for="phone">Phone: </label> <input type="tel" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" id="phone"
										title="Please format it like this: ###-###-####"
										name="phone" class="form-control" placeholder="012-345-6789"
										required th:field="*{phone}">
								</div>
							</td>
						</tr>
						<tr>
							<td>
									<div class="form-group row">
										<label for="Buildings">Buildings: </label>   
										   <select name="building" id="building" onChange="changeRoom(this.options[this.selectedIndex].value)" th:field="*{building}">
    										<option value = "" selected="selected">Select Building</option>
 											 </select>	
									</div>
							</td>
						</tr>
						<tr>
							<td>
									<div class="form-group row">
										<label for="Rooms">Room: </label>   
										<select name="room" id="room" th:field="*{room}">
    									<option value = "" selected="selected">Please select Building first</option>
  										</select>	
									</div>
							</td>
						</tr>
						<tr>
							<tr>
							<td>
									<div class="form-group row">
										<label for="Departments">Departments: </label>   
										<select name="department" id="department" th:field="*{department}">
    									<option value="" selected="selected">Please select Building first</option>
  									</select>	
									</div>
							</td>
						</tr>
						<tr>
						</tr>
						<tr>
						<td>
							<div class="form-group row">
								<label for="issue_type">Issue Type: </label> <select
									name="issue_type" id="issue_type" class="form-control" required
									th:field="*{issue_type}">
									<option th:value="'technical'">technical</option>
									<option th:value="'hardware'">hardware</option>
									<option th:value="'other example'">other example</option>
								</select>
							</div>
						</td>
						</tr>
						<tr>
							<td><label for="description">Description: </label></td>
						</tr>
						<tr>
							<td>
								<div class="form-group row">
									<textarea id="description" name="description"
										class="form-control" rows="5" cols="33"
										placeholder="Description of the problem" required
										th:field="*{description}"></textarea>
								</div>
							</td>
						</tr>
						<tr>
							<td>
								<div class="form-group row">
									<label for="User">CC: </label> <input type="text" id="cc"
									name="cc" class="form-control" pattern="(([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)(\s*;\s*|\s*$))*"
										title="all CC emails must be in the sru format: "
										placeholder=" CC Email Addresses: abc1234@sru.edu"
										th:field="*{cc}">
								</div>
							</td>
						</tr>
						<tr>
						<tr>
							<td>
								<div>
									<button type="submit" class="btn btn-primary" id="submit"
										style="font-family: Arial, Helvetica, sans-serif;">Submit</button>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</form>
	</div>
</body>
</html>